<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>新年许愿树</title>
    <!-- 引入Vue -->
    <!-- 引入样式 -->
    <!-- 引入组件库 -->
    <link rel='stylesheet' href='/public/css/bootstrap.min.css'>
   
    <link rel="stylesheet" href="/public/css/happyNewYear.css">
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- <script type="text/javascript" src="/public/js/happyNewYear.js"></script> -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



</head>

<body>
    <div id="app">          
        <img class="tree_bottom" src="/public/img/tree-04.png" alt="">
        <img class="tree_box" @click='ruleInline()' src="/public/img/box.png" alt="">
        <div class="tree tree_3">
            <img src="/public/img/tree-03.png" alt="">
        </div>
        <div class="tree tree_2">
            <img src="/public/img/tree-02.png" alt="">
        </div>
        <div class="tree tree_1" >
            <img src="/public/img/tree-01.png" alt="">
            <img class="star" v-for="(item,index) in star" ref="index" src="/public/img/star.png"  alt="">
        </div>
        <div id="login" class="base" v-show="login_show">
            <p class="x" @click='loginHide()' >x</p>
            <div v-if="signUp">
                <div class="aim">   
                    <h2>Hello 亲!</h2>
                    <h6>需要注册请点击下方！</h6>
                    <button @click="signUp = !signUp" class="btn ">注册</button>
                </div>
                <div class="formArea">
                    <h2>请您进行登录</h2>
                    <h6>登录完成即可许愿</h6>
    
                    <div class="form-group">
                        <input type="phone"  class="form-control" v-model="Login.phone" id="exampleInputPhone1" aria-describedby="phoneHelp" placeholder="电话">
                    </div>
                    <div class="form-group">
                        <input type="password"  class="form-control" v-model="Login.password" id="exampleInputPassword1" placeholder="密码">
                    </div>
                    <button class="btn" @click="loginSubmit()">登录</button>
    
                </div>
            </div>
            <div v-else>
                <div class="aim in">
                    <h2>欢迎回来!</h2>
                    <h6>注册完成请点击我</h6>
                    <button @click="signUp = !signUp" class="btn">登录</button>
                </div>
                <div class="formArea in">
                    <h2>注册您的信息</h2>
                    <h6>注册完成即可登录</h6>
                    <div class="form-group">
                        <input type="text" class="form-control" v-model="register.name" id="exampleInputName1" placeholder="姓名">
                    </div>
                    <div class="form-group">
                        <input type="phone" class="form-control" v-model="register.phone" id="exampleInputPhone2" aria-describedby="emailHelp" placeholder="电话">
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" id="exampleInputPassword2" v-model="register.password" placeholder="密码">
                    </div>
                    <button @click="registerSubmit()" class="btn">注册</button>
                </div>
    
            </div>
        </div>
        <div id="text" v-show="txtShow">
            <div class="popup">
                <textarea v-model="wish.content" rows="3" cols="20" placeholder="你的新年愿望"></textarea>
                <button @click="addWish_m()">确定</button>
                <button @click="textHide()">取消</button>
            </div>
          
        </div>
    </div>
    <script type="text/javascript" src="/public/js/vue.js"></script>
</body>
<script>
   var app =  new Vue({
        el: "#app",
        data() {
            return {
                star: [
                    { left: "6%", top: "64%" },
                    { left: "11%", top: "105%" },
                    { left: "52%", top: "90%" },
                    { left: "74%", top: "144%" },
                    { left: "12%", top: "154%" },
                ],
                signUp: true,
                login_show:false,
                txtShow:false,
                Login: {
                    phone: "",
                    password: "",
                    error: {
                        mobile: "",
                        password: "",
                        all: "",
                        text: ""
                    }
                },
                register: {
                    name: "",
                    phone: "",
                    password: "",
                    error: {
                        code: "",
                        password: "",
                        error: "",
                        mobile: "",
                    }
                },
                wish:{
                    userId:"",
                    content:""
                },
                localUrl: 'http://127.0.0.1:7001',
                requestUrl: 'http://172.81.214.190:7001'
            }

        },
        mounted() {
            axios.get('http://172.81.214.190:7001/user/chek').then(res=>{
                console.log(res)
                //获取十条愿望
            })
            this.changeStar()
        },

        methods: {
            loginShow:function(){
                this.login_show = true
            },
            loginHide:function(){
                this.login_show = false
            },
            textShow:function(){
                this.txtShow = true
            },
            textHide:function(){
                this.txtShow = false
            },
            changeStar:function() {
                for (const key in this.$refs.index) {
                    this.$refs.index[key].style.left = this.star[key].left
                    this.$refs.index[key].style.top = this.star[key].top
                }
            },
            loginSubmit() {
                event.stopPropagation()
                console.log(this.Login);
                
                this.Login.phone = document.getElementById('exampleInputPhone1').value;
		        this.Login.password = document.getElementById('exampleInputPassword1').value;
                if (this.Login.phone === '' || this.Login.password === '') {
                    return false;
                }
                axios.post(`${this.requestUrl}/user/login`, this.Login).then((response) => {
                    console.log(response);
                    sessionStorage.setItem("key", response.data.id);
                    this.loginHide()
                    if (response.status === 'success') {
                        //路由跳转
                        this.$router.push('/');
                    } else {
                        log(response.data);
                    }
                }).catch((error) => {
                    console.log("error");
                });
            },
            ruleInline:function() { 
                var lastname = sessionStorage.getItem("key");
                if(lastname!=null&&lastname!="undefined"){
                    this.textShow();
                }else{
                    this.loginShow();
                }   
            },
            checkPhoneNumber(phone){
                if(!(/^1[3456789]\d{9}$/.test(phone))){ 
                    alert("手机号码有误，请重填");  
                    return false; 
                }
                return true;
            },
            errorUnshow() {},
            registerSubmit() { 
                event.stopPropagation()
                console.log(this.register)
                if (!this.register.name || !this.register.password || !this.register.phone === '') {
                    return alert('密码用户名不能为空');
                }
                if(!this.checkPhoneNumber(this.register.phone)) return;
                axios.post(`${this.requestUrl}/user/register`, this.register).then((response) => {
                    this.signUp=true
                    if (response.status === 'success') {
                       alert('注册成功')
                    } else {
                        log(response.data);
                    }
                })
            },
            seedMessage() { },
            addWish_m(){
               this.wish.userId = sessionStorage.getItem("key");
               console.log(this.wish.userId,sessionStorage.getItem("key"));
               
                axios.post(`${this.requestUrl}/user/addwish`,this.wish).then((response) => {
                    console.log(response);
                    
                })
            }
            

        }
    })

</script>

</html>