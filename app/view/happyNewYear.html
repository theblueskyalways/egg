<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>新年许愿树</title>
    <!-- 引入Vue -->
    <!-- 引入样式 -->
    <!-- 引入组件库 -->
    <link rel='stylesheet' href='/public/css/bootstrap.min.css'>
   
    <link rel="stylesheet" href="/public/css/happyNewYear.css">
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- <script type="text/javascript" src="/public/js/happyNewYear.js"></script> -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



</head>

<body>
    <div id="app">
        <img class="tree_bottom" src="/public/img/tree-04.png" alt="">
        <img class="tree_box" @click='ruleInline()' src="/public/img/box.png" alt="">
        <div class="tree tree_3">
            <img src="/public/img/tree-03.png" alt="">
        </div>
        <div class="tree tree_2">
            <img src="/public/img/tree-02.png" alt="">
        </div>
        <div class="tree tree_1" >
            <img src="/public/img/tree-01.png" alt="">
            <img class="star" v-for="(item,index) in star" ref="index" src="/public/img/star.png"  alt="">
        </div>
        <div id="login" class="base" v-show="login_show">
            <p class="x" @click='loginHide()' >x</p>
            <div v-if="signUp">
                <div class="aim">   
                    <h2>Hello 亲!</h2>
                    <h6>需要注册请点击下方！</h6>
                    <button @click="signUp = !signUp" class="btn ">注册</button>
                </div>
                <div class="formArea">
                    <h2>请您进行登录</h2>
                    <h6>登录完成即可许愿</h6>
    
                    <div class="form-group">
                        <input type="phone"  class="form-control" id="exampleInputPhone1" aria-describedby="phoneHelp" placeholder="电话">
                    </div>
                    <div class="form-group">
                        <input type="password"  class="form-control" id="exampleInputPassword1" placeholder="密码">
                    </div>
                    <button class="btn" @click="loginSubmit()">登录</button>
    
                </div>
            </div>
            <div v-else>
                <div class="aim in">
                    <h2>欢迎回来!</h2>
                    <h6>注册完成请点击我</h6>
                    <button @click="signUp = !signUp" class="btn">登录</button>
                </div>
                <div class="formArea in">
                    <h2>注册您的信息</h2>
                    <h6>注册完成即可登录</h6>
                    <div class="form-group">
                        <input type="text" class="form-control" id="exampleInputName1" placeholder="姓名">
                    </div>
                    <div class="form-group">
                        <input type="phone" class="form-control" id="exampleInputPhone2" aria-describedby="emailHelp" placeholder="电话">
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" id="exampleInputPassword2" placeholder="密码">
                    </div>
                    <button @click="registerSubmit()" class="btn">注册</button>
                </div>
    
            </div>
        </div>
        <div id="text" v-show="txtShow">
            <div class="popup">
                <input type="text" placeholder="你的新年愿望">
                <button>确定</button>
                <button @click="textHide()">取消</button>
            </div>
          
        </div>
    </div>
    <script type="text/javascript" src="/public/js/vue.js"></script>
</body>
<script>
   var app =  new Vue({
        el: "#app",
        data() {
            return {
                star: [
                    { left: "6%", top: "64%" },
                    { left: "11%", top: "105%" },
                    { left: "52%", top: "90%" },
                    { left: "74%", top: "144%" },
                    { left: "12%", top: "154%" },
                ],
                signUp: true,
                login_show:false,
                txtShow:false,
                Login: {
                    name: "",
                    password: "",
                    error: {
                        mobile: "",
                        password: "",
                        all: "",
                        text: ""
                    }
                },
                Register: {
                    name: "",
                    code: "",
                    password: "",
                    error: {
                        code: "",
                        password: "",
                        error: "",
                        mobile: "",
                    }
                }
            }

        },
        mounted() {
            axios.get('http://172.81.214.190:7001/user/chek').then(res=>{
                console.log(res)
            })
            this.changeStar()
        },

        methods: {
            loginShow:function(){
                this.login_show = true
            },
            loginHide:function(){
                this.login_show = false
            },
            textShow:function(){
                this.txtShow = true
            },
            textHide:function(){
                this.txtShow = false
            },
            changeStar:function() {
                for (const key in this.$refs.index) {
                    this.$refs.index[key].style.left = this.star[key].left
                    this.$refs.index[key].style.top = this.star[key].top
                }
            },
            loginSubmit() {
                event.stopPropagation()
                this.Login.name = document.getElementById('exampleInputEmail1').value;
		        this.Login.password = document.getElementById('exampleInputPassword1').value;
                if (this.Login.name === '' || this.Login.password === '') {
                    return false;
                }
                
                axios.post('/user/login', this.Login).then((response) => {
                    console.log(response);
                    sessionStorage.setItem("key", response.data.id);
                    this.loginHide()
                    if (response.status === 'success') {
                        //路由跳转
                        this.$router.push('/');
                    } else {
                        log(response.data);
                    }
                }).catch((error) => {
                    console.log("error");
                });
            },
            ruleInline:function() { 
                console.log(111);
             
                var lastname = sessionStorage.getItem("key");
                if(lastname!=null){
                    this.textShow();
                }else{
                    this.loginShow();
                }   
            },
            errorUnshow() { },
            registerSubmit() { 
                event.stopPropagation()
                this.Register.name = document.getElementById('exampleInputPhone2').value;
                this.Register.code = document.getElementById('exampleInputName1').value;
		        this.Register.password = document.getElementById('exampleInputPassword2').value;
                if (this.Register.name === '' || this.Register.password === '' || this.Register.code === '') {
                    return false;
                }
                
                axios.post('/user/register', this.Register).then((response) => {
                    console.log(response);
                    this.signUp=true
                    if (response.status === 'success') {
                       console.log("ok");
                       
                    } else {
                        log(response.data);
                    }
                })
            },
            seedMessage() { }

        }
    })

</script>

</html>